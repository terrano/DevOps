<!DOCTYPE html>
<html lang="en">
  <head>
    <title>How To Protect SSH with Fail2Ban on Ubuntu 14.04 | DigitalOcean</title>

<meta name="description" content="Fail2ban is a daemon that can be run on your server to dynamically block clients that fail to authenticate correctly with your services repeatedly. This can help mitigate the affect of brute force attacks and illegitimate users of your services. In th">
<meta name="keywords" content="Security Linux Basics Firewall">

<meta name="og:title" content="How To Protect SSH with Fail2Ban on Ubuntu 14.04 | DigitalOcean">
<meta name="og:description" content="Fail2ban is a daemon that can be run on your server to dynamically block clients that fail to authenticate correctly with your services repeatedly. This can help mitigate the affect of brute force attacks and illegitimate users of your services. In th">
<meta name="og:site_name" content="DigitalOcean">
<meta name="og:type" content="article">

<meta name="twitter:site" content="DigitalOcean">
<meta name="twitter:title" content="How To Protect SSH with Fail2Ban on Ubuntu 14.04 | DigitalOcean">
<meta name="twitter:description" content="Fail2ban is a daemon that can be run on your server to dynamically block clients that fail to authenticate correctly with your services repeatedly. This can help mitigate the affect of brute force attacks and illegitimate users of your services. In th">
<meta name="twitter:creator" content="DigitalOcean">
<meta name="twitter:card" content="photo" />
<meta name="twitter:url" content="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04"/>

<meta property='og:image' content="https://www.digitalocean.com/assets/community/default_community_sharing-65c1cc547375d6e37cc45195b3686769.png">
<meta name="twitter:image" content="https://www.digitalocean.com/assets/community/default_community_sharing-65c1cc547375d6e37cc45195b3686769.png">

  <link rel='canonical' href='https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04'>


    <link rel="stylesheet" media="all" href="/assets/community/application-bdfc2d8fb85ad3fae4a82273144bb2f0.css" />

    
    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="/+To7uvukxWd0kpknHeF+yboGTaXw6IWwb0iV9r6N3je65EKj0DEuQ8qaZJbjIZ3cssKMZjEIYIdk34ZydGB+A==" />
      <script src="https://use.typekit.net/izu1uqu.js"></script>
      <script>try{Typekit.load({ async: true });}catch(e){}</script>
    <script
      src="https://d2wy8f7a9ursnm.cloudfront.net/bugsnag-2.min.js"
      data-apikey="9ffc01bc3e1fa7891bfd20909d1bfb0e">
    </script>
    <!--<script src="//cdn.optimizely.com/js/701281621.js"></script>-->
    <script type="text/javascript">
      if(window.analytics=window.analytics||[],window.analytics.included)window.console&&console.error&&console.error("analytics.js included twice");else{window.analytics.included=!0,window.analytics.methods=["identify","group","track","page","pageview","alias","ready","on","once","off","trackLink","trackForm","trackClick","trackSubmit"],window.analytics.factory=function(a){return function(){var n=Array.prototype.slice.call(arguments);return n.unshift(a),window.analytics.push(n),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var key=window.analytics.methods[i];window.analytics[key]=window.analytics.factory(key)}window.analytics.load=function(a){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+a+"/analytics.min.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t)},window.analytics.SNIPPET_VERSION="2.0.9",
      window.analytics.load("puo3uv968t")}
      window.analytics.page();
    </script>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/community/tutorials/feed">
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
    <script>
      window.comApp = {
        prefix: '/community',
        svgIconPath: 'https://www.digitalocean.com/assets/community/icon-sprite-d76eb75d70ccf8ffb4c0b47b7dbc88ca.svg',
        railsEnv: 'production',
        rootUrl: 'https://www.digitalocean.com/community'
      };
    </script>
    
    <script src="/assets/community/application-696ac533a18a8d515d9ba94d8863d059.js"></script>
  </head>
  <body class="feature-filter-bar feature-upvotes tutorials-controller tutorial-single" data-env="production" data-prefix="/community" data-user-id="" data-facebook-app-id="694818843983011"   data-completed-tutorial-id="" data-tutorial-id="1167" data-js="tutorial"
>
    <script>
//<![CDATA[

//]]>
</script>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-KHWBBT"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KHWBBT');</script>
<!-- End Google Tag Manager -->

    

    <div class='outside_viewport'>
        <div id="contents-modal" class="modal fade mini-modal" style="display: none;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1>Contents</h1>
          <button class="close-button icon icon-close-light" data-dismiss="modal" aria-label="close"></button>
        </div>
        <div class="modal-body">
          <div class="table-of-contents-modal"></div>
        </div>
      </div>
    </div>
  </div>
  <div id="share-modal" class="modal fade mini-modal" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1>Share</h1>
        <button type="button" class="close-button icon icon-close-light" aria-label="close" data-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="social-sharing social-sharing-container">
          <ul class="top ">
            <li class="shareBtn" id="sbTwitter">
              <a href="http://twitter.com/share?text=How To Protect SSH with Fail2Ban on Ubuntu 14.04&amp;url=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=twshare" class="share-icon share-popup" title="Share on Twitter" >
                <span class="sIcon icon-bird"></span>
              </a>
              <a href="http://twitter.com/share?text=How To Protect SSH with Fail2Ban on Ubuntu 14.04&amp;url=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=twshare" class="share-link share-popup" title="Share on Twitter" >
                Twitter
              </a>
            </li>
            <li class="shareBtn" id="sbFacebook">
              <a class="share-icon facebook-share" href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=fbshare" onclick="" title="Share on Facebook">
                <span class="sIcon icon-facebook-B"></span>
              </a>

              <a class="share-link facebook-share" href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=fbshare" onclick="" title="Share on Facebook">
                Facebook
              </a>
            </li>
            <li class="shareBtn" id="sbGoogle">
              <a href="https://plus.google.com/share?url=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=gpshare" class="share-icon share-popup" title="Share on Google+">
                <span class="sIcon icon-google-plus-B"></span>
              </a>
              <a href="https://plus.google.com/share?url=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=gpshare" class="share-link share-popup" title="Share on Google+">
                Google+
              </a>
            </li>
            <li class="shareBtn" id="sbYC">
              <a href="https://news.ycombinator.com/submitlink?t=How To Protect SSH with Fail2Ban on Ubuntu 14.04&amp;u=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=hnshare" class="share-icon share-popup" target="_blank" title="Submit to Hacker News">
                <span class="sIcon icon-hacker-news"></span>
              </a>
              <a href="https://news.ycombinator.com/submitlink?t=How To Protect SSH with Fail2Ban on Ubuntu 14.04&amp;u=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=hnshare" class="share-link share-popup" target="_blank" title="Submit to Hacker News">
                Hacker News
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="table-of-contents">
    <div data-js="tableOfContentsDesktop"></div>
    <button type="button" class="Button--reset Tutorial-button " data-js="markAsComplete" data-tutorialInteraction data-tutorialSingle><svg class='svg-icon svg-icon-completed'><use xlink:href='https://www.digitalocean.com/assets/community/icon-sprite-d76eb75d70ccf8ffb4c0b47b7dbc88ca.svg#icon-completed'></use></svg><span>Mark as Complete</span></button>
  </div>
  
  <div id="share-modal" class="modal fade mini-modal" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1>Share</h1>
        <button type="button" class="close-button icon icon-close-light" aria-label="close" data-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="social-sharing social-sharing-container">
          <ul class="bottom ">
            <li class="shareBtn" id="sbTwitter">
              <a href="http://twitter.com/share?text=How To Protect SSH with Fail2Ban on Ubuntu 14.04&amp;url=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=twshare" class="share-icon share-popup" title="Share on Twitter" >
                <span class="sIcon icon-bird"></span>
              </a>
              <a href="http://twitter.com/share?text=How To Protect SSH with Fail2Ban on Ubuntu 14.04&amp;url=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=twshare" class="share-link share-popup" title="Share on Twitter" >
                Twitter
              </a>
            </li>
            <li class="shareBtn" id="sbFacebook">
              <a class="share-icon facebook-share" href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=fbshare" onclick="" title="Share on Facebook">
                <span class="sIcon icon-facebook-B"></span>
              </a>

              <a class="share-link facebook-share" href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=fbshare" onclick="" title="Share on Facebook">
                Facebook
              </a>
            </li>
            <li class="shareBtn" id="sbGoogle">
              <a href="https://plus.google.com/share?url=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=gpshare" class="share-icon share-popup" title="Share on Google+">
                <span class="sIcon icon-google-plus-B"></span>
              </a>
              <a href="https://plus.google.com/share?url=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=gpshare" class="share-link share-popup" title="Share on Google+">
                Google+
              </a>
            </li>
            <li class="shareBtn" id="sbYC">
              <a href="https://news.ycombinator.com/submitlink?t=How To Protect SSH with Fail2Ban on Ubuntu 14.04&amp;u=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=hnshare" class="share-icon share-popup" target="_blank" title="Submit to Hacker News">
                <span class="sIcon icon-hacker-news"></span>
              </a>
              <a href="https://news.ycombinator.com/submitlink?t=How To Protect SSH with Fail2Ban on Ubuntu 14.04&amp;u=https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04?utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04&amp;utm_medium=community&amp;utm_source=hnshare" class="share-link share-popup" target="_blank" title="Submit to Hacker News">
                Hacker News
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>


      
    </div>

      <div class="mobile-nav">
  
<div class="account-buttons">
    <div id="entrance">
      <a id="sign-up" class="button" href="/community/auth/digitalocean?display=sessionless+register">Sign Up</a>
      <a id="log-in" class="button" href="/community/auth/digitalocean">Log In</a>
    </div>
</div>

  <button type="button" aria-label="close" class="close-panel icon-close"></button>

  <form class="mobile-search" role="search" action="/community/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
    <span class='icon icon-search-thin'></span>
    <input type="text" name="q" id="q" title="Search" placeholder="Search" />
    <button name="button" type="submit" class="icon-btn">submit</button>
</form>
  
<nav>

  <ul>
    <li><a class="active" href="/community/tutorials">Tutorials</a></li>
    <li><a href="/community/questions">Questions</a></li>
    <li><a href="/community/projects">Projects</a></li>
    <li><a href="https://www.meetup.com/pro/digitalocean/?utm_source=do_community" target="_blank">Meetups</a></li>
    <li class="mobile-nav-only"><a href="https://www.digitalocean.com/">Main Site</a></li>
  </ul>
</nav>

  
</div>

      
      <header>
  <div class="flash-container"></div>

  <div class='main-menu-container'>
    <div class='wrapper'>
      <div class='logo'>
        <a class="logo-icon" href="https://www.digitalocean.com/">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 190 32" class="do-icon">
<title>DigitalOcean</title>
<path class="path1" d="M16.016 32v-6.204c6.584 0 11.648-6.52 9.147-13.42-0.95-2.564-2.975-4.59-5.539-5.539-6.9-2.501-13.42 2.564-13.42 9.147 0 0 0 0 0 0l-6.204 0.032c0-10.477 10.129-18.643 21.112-15.225 4.811 1.488 8.609 5.317 10.097 10.097 3.418 10.983-4.716 21.112-15.193 21.112z"></path>
<path class="path2" d="M16.016 25.828h-6.172v-6.172h6.172z"></path>
<path class="path3" d="M9.844 30.576h-4.748v-4.748h4.748v4.748z"></path>
<path class="path4" d="M5.096 25.828h-3.988v-3.988h3.988z"></path>
<path class="path5" d="M56.973 9.242c-1.836-1.266-4.115-1.931-6.773-1.931h-5.792v18.39h5.792c2.659 0 4.938-0.665 6.773-2.026 1.013-0.696 1.804-1.709 2.342-2.944s0.823-2.69 0.823-4.336c0-1.614-0.285-3.070-0.823-4.305-0.538-1.203-1.329-2.152-2.342-2.849zM47.794 10.445h1.836c2.026 0 3.703 0.411 4.969 1.171 1.393 0.855 2.121 2.469 2.121 4.779 0 2.406-0.728 4.083-2.121 5.001v0c-1.203 0.791-2.88 1.203-4.938 1.203h-1.867v-12.154z"></path>
<path class="path6" d="M64.19 7.122c-0.57 0-1.044 0.19-1.424 0.57s-0.601 0.855-0.601 1.393c0 0.57 0.19 1.044 0.601 1.424 0.38 0.38 0.855 0.601 1.424 0.601s1.044-0.19 1.424-0.601c0.38-0.38 0.601-0.886 0.601-1.424 0-0.57-0.19-1.044-0.601-1.393-0.38-0.38-0.886-0.57-1.424-0.57z"></path>
<path class="path7" d="M62.512 12.787h3.26v12.977h-3.26v-12.977z"></path>
<path class="path8" d="M77.642 13.864c-0.981-0.886-2.089-1.393-3.26-1.393-1.804 0-3.292 0.633-4.463 1.836s-1.741 2.785-1.741 4.653c0 1.836 0.57 3.387 1.741 4.653 1.171 1.203 2.659 1.836 4.463 1.836 1.266 0 2.342-0.348 3.228-1.044v0.285c0 1.076-0.285 1.899-0.855 2.5-0.57 0.57-1.361 0.855-2.342 0.855-1.519 0-2.437-0.601-3.608-2.152l-2.216 2.121 0.063 0.095c0.475 0.665 1.203 1.329 2.184 1.962s2.184 0.95 3.64 0.95c1.931 0 3.513-0.601 4.653-1.773 1.171-1.171 1.741-2.754 1.741-4.716v-11.743h-3.197v1.076zM76.787 21.523c-0.57 0.633-1.298 0.95-2.247 0.95s-1.678-0.317-2.216-0.95c-0.57-0.633-0.855-1.488-0.855-2.532s0.285-1.931 0.855-2.564c0.57-0.633 1.298-0.981 2.216-0.981 0.95 0 1.678 0.317 2.247 0.981 0.57 0.633 0.855 1.519 0.855 2.564s-0.317 1.899-0.855 2.532z"></path>
<path class="path9" d="M83.624 12.787h3.26v12.977h-3.26v-12.977z"></path>
<path class="path10" d="M85.302 7.122c-0.57 0-1.044 0.19-1.424 0.57s-0.601 0.855-0.601 1.393c0 0.57 0.19 1.044 0.601 1.424 0.38 0.38 0.855 0.601 1.424 0.601s1.044-0.19 1.424-0.601c0.38-0.38 0.601-0.886 0.601-1.424 0-0.57-0.19-1.044-0.601-1.393-0.38-0.38-0.886-0.57-1.424-0.57z"></path>
<path class="path11" d="M94.038 9.274h-3.197v3.513h-1.867v2.975h1.867v5.381c0 1.678 0.348 2.88 1.013 3.577s1.836 1.044 3.513 1.044c0.538 0 1.076-0.032 1.583-0.063h0.158v-2.975l-1.108 0.063c-0.791 0-1.298-0.127-1.551-0.411s-0.38-0.855-0.38-1.709v-4.906h3.039v-2.975h-3.039v-3.513z"></path>
<path class="path12" d="M112.364 7.343h3.26v18.39h-3.26v-18.39z"></path>
<path class="path13" d="M148.574 21.112c-0.57 0.665-1.171 1.234-1.646 1.519v0c-0.443 0.285-1.013 0.443-1.678 0.443-0.95 0-1.741-0.348-2.374-1.076s-0.95-1.646-0.95-2.754 0.317-2.026 0.918-2.722c0.633-0.728 1.393-1.076 2.342-1.076 1.044 0 2.152 0.665 3.102 1.773l2.152-2.057c-1.393-1.836-3.197-2.69-5.349-2.69-1.804 0-3.355 0.665-4.621 1.931s-1.899 2.912-1.899 4.843 0.633 3.545 1.899 4.843c1.266 1.298 2.817 1.931 4.621 1.931 2.374 0 4.273-1.013 5.539-2.88l-2.057-2.026z"></path>
<path class="path14" d="M161.962 14.591c-0.475-0.633-1.108-1.171-1.867-1.551-0.791-0.38-1.678-0.57-2.69-0.57-1.836 0-3.323 0.665-4.431 1.994-1.076 1.329-1.646 2.944-1.646 4.874 0 1.962 0.601 3.577 1.804 4.843 1.171 1.234 2.785 1.867 4.716 1.867 2.184 0 4.020-0.886 5.349-2.659l0.063-0.095-2.121-2.057c-0.19 0.253-0.475 0.506-0.728 0.76-0.317 0.317-0.633 0.538-0.95 0.696-0.475 0.253-1.044 0.348-1.646 0.348-0.918 0-1.646-0.253-2.216-0.791-0.538-0.475-0.855-1.139-0.918-1.962h8.641l0.032-1.203c0-0.855-0.127-1.646-0.348-2.406-0.222-0.728-0.57-1.456-1.044-2.089zM154.841 17.63c0.158-0.633 0.443-1.139 0.855-1.551 0.443-0.443 1.013-0.665 1.709-0.665 0.791 0 1.393 0.222 1.804 0.665 0.38 0.411 0.601 0.918 0.665 1.519h-5.033z"></path>
<path class="path15" d="M174.497 13.737v0c-0.981-0.855-2.342-1.266-4.051-1.266-1.076 0-2.089 0.253-3.007 0.696-0.855 0.443-1.678 1.139-2.216 2.089l0.032 0.032 2.089 1.994c0.855-1.361 1.804-1.836 3.070-1.836 0.696 0 1.234 0.19 1.678 0.538s0.633 0.823 0.633 1.393v0.633c-0.823-0.253-1.614-0.38-2.406-0.38-1.614 0-2.944 0.38-3.925 1.139s-1.488 1.867-1.488 3.229c0 1.203 0.411 2.216 1.266 2.944 0.855 0.696 1.899 1.076 3.134 1.076s2.406-0.506 3.45-1.361v1.076h3.197v-8.324c0.063-1.583-0.443-2.817-1.456-3.672zM168.704 20.795c0.38-0.253 0.886-0.38 1.551-0.38 0.791 0 1.614 0.158 2.469 0.475v1.266c-0.696 0.665-1.646 0.981-2.817 0.981-0.57 0-1.013-0.127-1.298-0.38s-0.443-0.538-0.443-0.95c0-0.443 0.19-0.76 0.538-1.013z"></path>
<path class="path16" d="M188.55 13.99c-0.918-1.013-2.184-1.519-3.798-1.519-1.298 0-2.342 0.38-3.134 1.108v-0.791h-3.197v12.977h3.26v-7.185c0-0.981 0.222-1.773 0.696-2.311 0.475-0.57 1.076-0.823 1.931-0.823 0.728 0 1.298 0.253 1.709 0.728 0.411 0.506 0.633 1.171 0.633 2.026v7.501h3.26v-7.47c0-1.804-0.443-3.229-1.361-4.241z"></path>
<path class="path17" d="M108.281 13.737v0c-0.981-0.855-2.342-1.266-4.051-1.266-1.076 0-2.089 0.253-3.007 0.696-0.855 0.443-1.678 1.139-2.216 2.089l0.032 0.032 2.089 1.994c0.855-1.361 1.804-1.836 3.070-1.836 0.696 0 1.234 0.19 1.678 0.538s0.633 0.823 0.633 1.393v0.633c-0.823-0.253-1.614-0.38-2.406-0.38-1.614 0-2.944 0.38-3.925 1.139s-1.488 1.867-1.488 3.229c0 1.203 0.411 2.216 1.266 2.944 0.855 0.696 1.899 1.076 3.134 1.076s2.406-0.506 3.45-1.361v1.076h3.197v-8.324c0.032-1.583-0.475-2.817-1.456-3.672zM102.489 20.795c0.38-0.253 0.886-0.38 1.551-0.38 0.791 0 1.614 0.158 2.469 0.475v1.266c-0.696 0.665-1.646 0.981-2.817 0.981-0.57 0-1.013-0.127-1.298-0.38s-0.443-0.538-0.443-0.95c0-0.443 0.158-0.76 0.538-1.013z"></path>
<path class="path18" d="M127.462 26.018c-5.223 0-9.496-4.241-9.496-9.496s4.241-9.496 9.496-9.496 9.496 4.241 9.496 9.496-4.273 9.496-9.496 9.496zM127.462 10.382c-3.387 0-6.14 2.754-6.14 6.14s2.754 6.14 6.14 6.14 6.14-2.754 6.14-6.14-2.754-6.14-6.14-6.14z"></path>
</svg>

          <span class="sr-only">DigitalOcean</span>
</a>
        <span class="logo-separator"></span>

        <a class="home-link" href="/community">
          <span class='logo-community-text'>Community</span>
</a>      </div>

      <a class="mobile-nav-toggle icon-menu-thin" data-role="left">
        <span>Menu</span>
      </a>

      
<nav>

  <ul>
    <li><a class="active" href="/community/tutorials">Tutorials</a></li>
    <li><a href="/community/questions">Questions</a></li>
    <li><a href="/community/projects">Projects</a></li>
    <li><a href="https://www.meetup.com/pro/digitalocean/?utm_source=do_community" target="_blank">Meetups</a></li>
    <li class="mobile-nav-only"><a href="https://www.digitalocean.com/">Main Site</a></li>
  </ul>
</nav>


      
<div class="account-buttons">
    <div id="entrance">
      <a id="sign-up" class="button" href="/community/auth/digitalocean?display=sessionless+register">Sign Up</a>
      <a id="log-in" class="button" href="/community/auth/digitalocean">Log In</a>
    </div>
</div>
      <div class='header-search open'>
  <form action="/community/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
    <span class='icon icon-search-thin'></span>
    <input type="text" name="q" id="q" title="Search" placeholder="Search" autocomplete="off" spellcheck="false" class="header-search-input" data-algolia-application-id="6ZHEUVKJ88" data-algolia-api-key="c5470567eae7fa1177d43222e18ba086" />
    <button name="button" type="submit" class="icon-btn">submit</button>
</form></div>

<div class="search-results-dropdown dropdown" data-root-path="https://www.digitalocean.com/community">
  <div class="container">
    <div class='header-search-results-list'></div>

    <div id="btn-wrap">
      <a class="more-search-results" data-search-path="/community/search" href="/community/search">
        <span class='icon-mag'></span>
        View All Results
</a>    </div>
  </div>
</div>

<script type='text/template' id='autocomplete-hits-template'>
  <div class="inner-search">
    <ul>
        {{#hits}}
          <li>
            <span class='icon icon-{{type}}'></span>
            <a href='{{url}}'>{{title}}</a>
          </li>
        {{/hits}}
    </ul>
  </div>
</script>


      <div class='clearfix'></div>
    </div>
  </div>

  <div class='wrapper'>
    
  </div>
</header>


      

      <div class='wrapper layout-wrapper'>

        









<div class="section-content section-content-growable content Tutorial-content">
  <div class='postable-info-bar-container'>
  <div class='postable-info-bar'>
    <div class='left-section'>
        <div class='tutorial-author-avatar'>
    <a href="/community/users/jellingwood"><div class="mod-avatar mod-avatar-small"><img alt="jellingwood" class="avatar avatar-small" src="https://secure.gravatar.com/avatar/60d901f61a6146e14a3e989bc1f4ef11?secure=true&d=identicon" width="80" height="80" /><span class="mod-star" title="MOD" data-toggle="tooltip" data-container="body"><span class="mod-star-icon" /></span></div></a>
  </div>
  <div class='author-and-date'>
    <div class='tutorial-author'>
      <div class='by'>By: </div>
      <a href="/community/users/jellingwood">Justin Ellingwood</a>
    </div>
  </div>

      
    </div>

    <div class='right-section'>
      


      <div class="section-item section-item-subscribe">
  <span class="opt-in-switch off signed-out-subscribe">
    <span class="subscribe-label">
      <span class="icon icon-subscribe"></span>
      <span class="subscription-label subscribe">Subscribe</span>
      <span class="icon icon-subscribed"></span>
      <span class="subscription-label subscribed">Subscribed</span>
    </span>
    <a data-toggle="modal" data-target="#sign-in-modal" class="mini-switch-container" href="javascript:void(0);"><div class="mini-switch off signed-out-subscribe"><div class="switch-handle"></div></div></a>
  </span>
</div>

<div class='section-item social-sharing-item'>
  <div class="sharing">
  <a class="share-button" href="#" data-toggle="modal" data-target="#share-modal">
    <span class="icon icon-share-square"></span>
    <span class="share-button-text">Share</span>
  </a>
</div>

</div>

        <div class='section-item table-of-contents-triggers'><div class="toc-trigger-mobile" data-toggle="modal" data-target="#contents-modal">
  <a href="javascript:void(0);">
    <span class="icon icon-contents"></span>
    <span class="title">Contents</span>
    <span class="icon icon-arrow-down"></span>
  </a>
</div>

</div>

    </div>
  </div>
</div>



  <div class="container tutorial-header">

      <div class='info-cta'>
    <a class="icon-close-light" href="javascript:void();"></a>
    We hope you find this tutorial helpful. In addition to guides like this one, we provide simple cloud infrastructure for developers. <a href="https://www.digitalocean.com/?utm_medium=community&amp;utm_source=community_gencta&amp;utm_campaign=needaserver&amp;utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04">
        Learn more &rarr;
</a>  </div>


    <button name="button" type="button" class="new-upvote-button" data-upvotable-id="1167" data-upvotable-type="Tutorial" data-include-caret="true"><span class="icon new-upvote-icon"><svg class='svg-icon svg-icon-upvote-empty'><use xlink:href='https://www.digitalocean.com/assets/community/icon-sprite-d76eb75d70ccf8ffb4c0b47b7dbc88ca.svg#icon-upvote-empty'></use></svg></span><span class="new-upvote-count">111</span></button>

    <h1 class="content-title Tutorial-header">
      <button type="button" class="Button--reset Tutorial-headerButton " data-toggle="tooltip" title="Mark as Complete" data-js="markAsComplete" data-tutorialInteraction data-tutorialSingle>
        <svg class='svg-icon svg-icon-completed'><use xlink:href='https://www.digitalocean.com/assets/community/icon-sprite-d76eb75d70ccf8ffb4c0b47b7dbc88ca.svg#icon-completed'></use></svg>
      </button> How To Protect SSH with Fail2Ban on Ubuntu 14.04
    </h1>

    <span class="meta-section timestamp"><span class="tutorial-date-text">Posted</span><span class="tutorial-date">May  7, 2014</span></span>

    <span class="meta-section pageviews"><span class="icon icon-eye v-mid"></span><span class="views-count v-mid">467.2k</span><span class="sr-only"> views</span></span>

    <span class="meta-section tags">
      <a class="tag" href="/community/tags/security?type=tutorials">Security</a> <a class="tag" href="/community/tags/firewall?type=tutorials">Firewall</a> <a class="tag" href="/community/tags/linux-basics?type=tutorials">Linux Basics</a>
      <a class="tag" href="/community/tags/ubuntu?type=tutorials">Ubuntu</a>
    </span>
  </div>
    <div class="content-body tutorial-content tutorial-content-legacy" data-growable-markdown>
      <h3 id="introduction">Introduction</h3>

<p>While connecting to your server through SSH can be very secure, the SSH daemon itself is a service that must be exposed to the internet to function properly.  This comes with some inherent risk and creates a vector of attack for would-be assailants.</p>

<p>Any service that is exposed to the network is a potential target in this way.  If you pay attention to application logs for these services, you will often see repeated, systematic login attempts that represent brute force attacks by users and bots alike.</p>

<p>A service called <strong>fail2ban</strong> can mitigate this problem by creating rules that can automatically alter your <code>iptables</code> firewall configuration based on a predefined number of unsuccessful login attempts.  This will allow your server to respond to illegitimate access attempts without intervention from you.</p>

<p>In this guide, we'll cover how to install and use fail2ban on an Ubuntu 14.04 server.</p>

<h2 id="install-fail2ban-on-ubuntu-14-04">Install Fail2Ban on Ubuntu 14.04</h2>

<p>The installation process for this tool is simple because the Ubuntu packaging team maintains a package in the default repositories.</p>

<p>First, we need to update our local package index and then we can use <code>apt</code> to download and install the package:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt-get update
</li><li class="line" prefix="$">sudo apt-get install fail2ban
</li></ul></code></pre>
<p>As you can see, the installation is trivial.  We can now begin configuring the utility for our own use.</p>

<h2 id="configure-fail2ban-with-your-service-settings">Configure Fail2Ban with your Service Settings</h2>

<p>The fail2ban service keeps its configuration files in the <code>/etc/fail2ban</code> directory.  There is a file with defaults called <code>jail.conf</code>.</p>

<p>Since this file can be modified by package upgrades, we should not edit this file in-place, but rather copy it so that we can make our changes safely.  In order for these two files to operate together successfully, it is best to only include the settings you wish to override in the <code>jail.local</code> file.  All default options will be taken from the <code>jail.conf</code> file.</p>

<p>Even though we should only include deviations from the default in the <code>jail.local</code> file, it is easier to create a <code>jail.local</code> file based on the existing <code>jail.conf</code> file.  So we will copy over that file, with the contents commented out, as the basis for the <code>jail.local</code> file.  You can do this by typing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">awk '{ printf "# "; print; }' /etc/fail2ban/jail.conf | sudo tee /etc/fail2ban/jail.local
</li></ul></code></pre>
<p>Once the file is copied, we can open the original <code>jail.conf</code> file to see how things are set up by default</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/fail2ban/jail.conf
</li></ul></code></pre>
<p>In this file, there are a few settings you may wish to adjust.  The settings located under the <code>[DEFAULT]</code> section will be applied to all services enabled for fail2ban that are not overridden in the service's own section.</p>
<div class="code-label " title="/etc/fail2ban/jail.conf">/etc/fail2ban/jail.conf</div><pre class="code-pre "><code langs="">[DEFAULT]
. . .
ignoreip = 127.0.0.1/8
. . .
</code></pre>
<p>The <code>ignoreip</code> setting configures the source addresses that fail2ban ignores.  By default, it is configured to not ban any traffic coming from the local machine.  You could add additional addresses to ignore by adding a <code>[DEFAULT]</code> section with an <code>ignoreip</code> setting under it to the <code>jail.local</code> file.  You can add additional addresses by appending them to the end of the directive, separated by a space.</p>
<div class="code-label " title="/etc/fail2ban/jail.conf">/etc/fail2ban/jail.conf</div><pre class="code-pre "><code langs="">[DEFAULT]
. . .
bantime = 600
. . .
</code></pre>
<p>The <code>bantime</code> parameter sets length of time that a client will be banned when they have failed to authenticate correctly.  This is measured in seconds.  By default, this is set to 600 seconds, or 10 minutes.</p>
<div class="code-label " title="/etc/fail2ban/jail.conf">/etc/fail2ban/jail.conf</div><pre class="code-pre "><code langs="">[DEFAULT]
. . .
findtime = 600
maxretry = 3
. . .
</code></pre>
<p>The next two parameters that you want to pay attention to are <code>findtime</code> and <code>maxretry</code>.  These work together to establish the conditions under which a client is found to be an illegitimate user that should be banned.</p>

<p>The <code>maxretry</code> variable sets the number of tries a client has to authenticate within a window of time defined by <code>findtime</code>, before being banned.  With the default settings, the fail2ban service will ban a client that unsuccessfully attempts to log in 3 times within a 10 minute window.</p>
<div class="code-label " title="/etc/fail2ban/jail.conf">/etc/fail2ban/jail.conf</div><pre class="code-pre "><code langs="">[DEFAULT]
. . .
destemail = root@localhost
sendername = Fail2Ban
mta = sendmail
. . .
</code></pre>
<p>You will want to evaluate the <code>destemail</code>, <code>sendername</code>, and <code>mta</code> settings if you wish to configure email alerts.  The <code>destemail</code> parameter sets the email address that should receive ban messages.  The <code>sendername</code> sets the value of the "From" field in the email.  The <code>mta</code> parameter configures what mail service will be used to send mail.  Again, add these to the <code>jail.local</code> file, under the <code>[DEFAULT]</code> header and set to the proper values if you wish to adjust them.</p>
<div class="code-label " title="/etc/fail2ban/jail.conf">/etc/fail2ban/jail.conf</div><pre class="code-pre "><code langs="">[DEFAULT]
. . .
action = $(action_)s
. . .
</code></pre>
<p>This parameter configures the action that fail2ban takes when it wants to institute a ban.  The value <code>action_</code> is defined in the file shortly before this parameter.  The default action is to simply configure the firewall to reject traffic from the offending host until the ban time elapses.</p>

<p>If you would like to configure email alerts, add or uncomment the <code>action</code> item to the <code>jail.local</code> file and change its value from <code>action_</code> to <code>action_mw</code>.  If you want the email to include the relevant log lines, you can change it to <code>action_mwl</code>.  Make sure you have the appropriate mail settings configured if you choose to use mail alerts.</p>

<h3 id="individual-jail-settings">Individual Jail Settings</h3>

<p>Finally, we get to the portion of the configuration file that deals with individual services.  These are specified by the section headers, like <code>[ssh]</code>.</p>

<p>Each of these sections can be enabled by uncommenting the header in <code>jail.local</code> and changing the <code>enabled</code> line to be "true":</p>
<div class="code-label " title="/etc/fail2ban/jail.local">/etc/fail2ban/jail.local</div><pre class="code-pre "><code langs="">[<span class="highlight">jail_to_enable</span>]
. . .
enabled = <span class="highlight">true</span>
. . .
</code></pre>
<p>By default, the SSH service is enabled and all others are disabled.</p>

<p>These sections work by using the values set in the <code>[DEFAULT]</code> section as a basis and modifying them as needed.  If you want to override any values, you can do so by adding the appropriate service's section to <code>jail.local</code> and modifying its values.</p>

<p>Some other settings that are set here are the <code>filter</code> that will be used to decide whether a line in a log indicates a failed authentication and the <code>logpath</code> which tells fail2ban where the logs for that particular service are located.</p>

<p>The <code>filter</code> value is actually a reference to a file located in the <code>/etc/fail2ban/filter.d</code> directory, with its <code>.conf</code> extension removed.  These files contain the regular expressions that determine whether a line in the log is a failed authentication attempt.  We won't be covering these files in-depth in this guide, because they are fairly complex and the predefined settings match appropriate lines well.</p>

<p>However, you can see what kind of filters are available by looking into that directory:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">ls /etc/fail2ban/filter.d
</li></ul></code></pre>
<p>If you see a file that looks to be related to a service you are using, you should open it with a text editor.  Most of the files are fairly well commented and you should be able to at least tell what type of condition the script was designed to guard against.  Most of these filters have appropriate (disabled) sections in the <code>jail.conf</code> file that we can enable in the <code>jail.local</code> file if desired.</p>

<p>For instance, pretend that we are serving a website using Nginx and realize that a password-protected portion of our site is getting slammed with login attempts.  We can tell fail2ban to use the <code>nginx-http-auth.conf</code> file to check for this condition within the <code>/var/log/nginx/error.log</code> file.</p>

<p>This is actually already set up in a section called <code>[nginx-http-auth]</code> in our <code>/etc/fail2ban/jail.conf</code> file.  We would just need to uncomment the section in the <code>jail.local</code> file and flip the <code>enabled</code> parameter to protect our service:</p>
<div class="code-label " title="/etc/fail2ban/jail.local">/etc/fail2ban/jail.local</div><pre class="code-pre "><code langs="">. . .
[nginx-http-auth]

enabled = <span class="highlight">true</span>
. . .
</code></pre>
<p>If you enable this, you'll want to restart your fail2ban service to make sure your rules are constructed correctly.</p>

<h2 id="putting-it-all-together">Putting It All Together</h2>

<p>Now that you understand the basic idea behind fail2ban, let's run through a basic setup.</p>

<p>We're going to configure a auto-banning policy for SSH and Nginx, just as we described above.  We want fail2ban to email us when an IP is banned.</p>

<p>First, let's install all of the relevant software. </p>

<p>If you don't already have it, you'll need nginx, since we're going to be monitoring its logs, and you'll need sendmail to mail us notifications.  We'll also grab <code>iptables-persistent</code> to allow the server to automatically set up our firewall rules at boot.  These can be acquired from Ubuntu's default repositories:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo apt-get update
</li><li class="line" prefix="$">sudo apt-get install nginx sendmail iptables-persistent
</li></ul></code></pre>
<p>Stop the <code>fail2ban</code> service for a moment so that we can establish a base firewall without the rules it adds:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo service fail2ban stop
</li></ul></code></pre>
<h3 id="establish-a-base-firewall">Establish a Base Firewall</h3>

<p>When that is finished, we should implement a default firewall.  You can learn <a href="https://www.digitalocean.com/community/articles/how-to-set-up-a-firewall-using-iptables-on-ubuntu-14-04">how to configure an iptables firewall on Ubuntu 14.04</a> here.  We are going to just create a basic firewall for this guide.</p>

<p>We're going to tell it to allow established connections, traffic generated by the server itself, traffic destined for our SSH and web server ports.  We will drop all other traffic.  We can set this basic firewall up by typing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo iptables -A INPUT -i lo -j ACCEPT
</li><li class="line" prefix="$">sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
</li><li class="line" prefix="$">sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
</li><li class="line" prefix="$">sudo iptables -A INPUT -p tcp -m multiport --dports 80,443 -j ACCEPT
</li><li class="line" prefix="$">sudo iptables -A INPUT -j DROP
</li></ul></code></pre>
<p>These commands will implement the above policy.  We can see our current firewall rules by typing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo iptables -S
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>-P INPUT ACCEPT
-P FORWARD ACCEPT
-P OUTPUT ACCEPT
<span class="highlight">-A INPUT -i lo -j ACCEPT</span>
<span class="highlight">-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span>
<span class="highlight">-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT</span>
<span class="highlight">-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT</span>
<span class="highlight">-A INPUT -j DROP</span>
</code></pre>
<p>You can save the firewalls so that they survive a reboot by typing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo dpkg-reconfigure iptables-persistent
</li></ul></code></pre>
<p>Afterwards, you can restart <code>fail2ban</code> to implement the wrapping rules:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo service fail2ban start
</li></ul></code></pre>
<p>We can see our current firewall rules by typing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo iptables -S
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>-P INPUT ACCEPT
-P FORWARD ACCEPT
-P OUTPUT ACCEPT
<span class="highlight">-N fail2ban-ssh</span>
<span class="highlight">-A INPUT -p tcp -m multiport --dports 22 -j fail2ban-ssh</span>
-A INPUT -i lo -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -j DROP
<span class="highlight">-A fail2ban-ssh -j RETURN</span>
</code></pre>
<p>We have our default policy for each of our chains, and then the five base rules that we established.  In red, we also have the default structure set up by fail2ban since it already implements SSH banning policies by default.  These may or may not show up at first, since sometimes <code>fail2ban</code> does not add the structure until the first ban is implemented.</p>

<h3 id="adjusting-the-fail2ban-configuration">Adjusting the Fail2ban Configuration</h3>

<p>Now, we need to configure fail2ban using the settings we'd like.  Open the <code>jail.local</code> file:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo nano /etc/fail2ban/jail.local
</li></ul></code></pre>
<p>We can set a more severe ban time here.  Find and uncomment the <code>[DEFAULT]</code> heading.  Under the default heading, change the <code>bantime</code> setting so that our service bans clients for half an hour:</p>
<div class="code-label " title="/etc/fail2ban/jail.local">/etc/fail2ban/jail.local</div><pre class="code-pre "><code langs=""><span class="highlight">[DEFAULT]</span>
. . .
<span class="highlight">bantime = 1800</span>
. . .
</code></pre>
<p>We also need to configure our alert email information.  First, find the <code>destemail</code> parameter, which should also be under the <code>[DEFAULT]</code> heading.  Put in the email address that you want to use to collect these messages:</p>
<div class="code-label " title="/etc/fail2ban/jail.local">/etc/fail2ban/jail.local</div><pre class="code-pre "><code langs="">[DEFAULT]
. . .
destemail = <span class="highlight">admin@example.com</span>
. . .
</code></pre>
<p>You can set the <code>sendername</code> to something else if you'd like.  It's useful to have a value that can be easily filtered using your mail service though, or else your regular inbox may get flooded with alerts if there are a lot of break in attempts from various places.</p>

<p>Moving down, we need to adjust the <code>action</code> parameter to one of the actions that sends us email.  The choices are between <code>action_mw</code> which institutes the ban and then emails us a "whois" report on the offending host, or <code>action_mwl</code> which does the above, but also emails the relevant log lines.</p>

<p>We're going to chose <code>action_mwl</code> because the log lines will help us troubleshoot and gather more information if there are issues:</p>
<div class="code-label " title="/etc/fail2ban/jail.local">/etc/fail2ban/jail.local</div><pre class="code-pre "><code langs="">[DEFAULT]
. . .
<span class="highlight">action = %(action_mwl)s</span>
. . .
</code></pre>
<p>Moving on to our SSH section, if we want to adjust the amount of unsuccessful attempts that should be allowed before a ban is established, you can edit the <code>maxretry</code> entry.  If you are using a port other than "22", you'll want to adjust the <code>port</code> parameter appropriately.  As we said before, this service is already enabled, so we don't need to modify that.</p>

<p>Next, search for the <code>nginx-http-auth</code> section.  Uncomment the header and change the <code>enabled</code> parameter to read "true".</p>
<div class="code-label " title="/etc/fail2ban/jail.local">/etc/fail2ban/jail.local</div><pre class="code-pre "><code langs="">. . .
<span class="highlight">[nginx-http-auth]</span>

<span class="highlight">enabled = true</span>
. . .
</code></pre>
<p>This should be all you have to do this section unless your web server is operating on non-standard ports or if you moved the default error log path.</p>

<h3 id="restarting-the-fail2ban-service">Restarting the Fail2ban Service</h3>

<p>When you are finished, save and close the file.</p>

<p>Now, start or restart your fail2ban service.  Sometimes, it's better to completely shut down the service and then start it again:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo service fail2ban stop
</li></ul></code></pre>
<p>Now we can restart it by typing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo service fail2ban start
</li></ul></code></pre>
<p>It may take a few moments for all of your firewall rules to be populated.  Sometimes, the rules are not added until the first ban of that type is instituted.  However, after a time, you can check the new rules by typing:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo iptables -S
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>-P INPUT ACCEPT
-P FORWARD ACCEPT
-P OUTPUT ACCEPT
<span class="highlight">-N fail2ban-nginx-http-auth</span>
<span class="highlight">-N fail2ban-ssh</span>
<span class="highlight">-A INPUT -p tcp -m multiport --dports 80,443 -j fail2ban-nginx-http-auth</span>
<span class="highlight">-A INPUT -p tcp -m multiport --dports 22 -j fail2ban-ssh</span>
-A INPUT -i lo -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -j DROP
<span class="highlight">-A fail2ban-nginx-http-auth -j RETURN</span>
<span class="highlight">-A fail2ban-ssh -j RETURN</span>
</code></pre>
<p>The lines in red are the ones that our fail2ban policies have created.  Right now, they are just directing traffic to new, almost empty chains and then letting the traffic flow right back into the INPUT chain.</p>

<p>However, these new chains are where the banning rules will be added.</p>

<h3 id="testing-the-banning-policies">Testing the Banning Policies</h3>

<p>From another server, one that won't need to log into your fail2ban server with, we can test the rules by getting our second server banned.</p>

<p>After logging into your second server, try to SSH into the fail2ban server.  You can try to connect using a non-existent name for instance:</p>
<pre class="code-pre custom_prefix"><code langs=""><ul class="prefixed"><li class="line" prefix="local$">ssh blah@<span class="highlight">fail2ban_server_IP</span>
</li></ul></code></pre>
<p>Enter random characters into the password prompt.  Repeat this a few times.  At some point, the fail2ban server will stop responding with the <code>Permission denied</code> message.  This signals that your second server has been banned from the fail2ban server.</p>

<p>On your fail2ban server, you can see the new rule by checking our iptables again:</p>
<pre class="code-pre command"><code langs=""><ul class="prefixed"><li class="line" prefix="$">sudo iptables -S
</li></ul></code></pre><pre class="code-pre "><code langs=""><div class="secondary-code-label " title="Output">Output</div>-P INPUT ACCEPT
-P FORWARD ACCEPT
-P OUTPUT ACCEPT
-N fail2ban-nginx-http-auth
-N fail2ban-ssh
-A INPUT -p tcp -m multiport --dports 80,443 -j fail2ban-nginx-http-auth
-A INPUT -p tcp -m multiport --dports 22 -j fail2ban-ssh
-A INPUT -i lo -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -j DROP
-A fail2ban-nginx-http-auth -j RETURN
<span class="highlight">-A fail2ban-ssh -s 203.0.113.14/32 -j REJECT --reject-with icmp-port-unreachable</span>
-A fail2ban-ssh -j RETURN
</code></pre>
<p>As you can see in the highlighted line, we have a new rule in our configuration which rejects traffic to the SSH port coming from our second server's IP address.  You should have also gotten an email about the ban in the account you configured.</p>

<h2 id="conclusion">Conclusion</h2>

<p>You should now be able to configure some basic banning policies for your services.  Fail2ban is very easy to set up, and is a great way to protect any kind of service that uses authentication.</p>

<p>If you want to learn more about how fail2ban works, you can check out our tutorial on <a href="https://www.digitalocean.com/community/articles/how-fail2ban-works-to-protect-services-on-a-linux-server">how fail2ban rules and files work</a>.</p>

<p>For information about how to use fail2ban to protect other services, try these links:</p>

<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-protect-an-nginx-server-with-fail2ban-on-ubuntu-14-04">How To Protect an Nginx Server with Fail2Ban on Ubuntu 14.04</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-protect-an-apache-server-with-fail2ban-on-ubuntu-14-04">How To Protect an Apache Server with Fail2Ban on Ubuntu 14.04</a></li>
</ul>

    </div>
</div>

<div class="tutorial-footer">
  <div class='tutorial-footer-details'>

  <div class='postable-info-bar-container'>
  <div class='postable-info-bar'>
    <div class='left-section'>
        <div class='tutorial-author-avatar'>
    <a href="/community/users/jellingwood"><div class="mod-avatar mod-avatar-small"><img alt="jellingwood" class="avatar avatar-small" src="https://secure.gravatar.com/avatar/60d901f61a6146e14a3e989bc1f4ef11?secure=true&d=identicon" width="80" height="80" /><span class="mod-star" title="MOD" data-toggle="tooltip" data-container="body"><span class="mod-star-icon" /></span></div></a>
  </div>
  <div class='author-and-date'>
    <div class='tutorial-author'>
      <div class='by'>By: </div>
      <a href="/community/users/jellingwood">Justin Ellingwood</a>
    </div>
  </div>

    </div>
    <div class='right-section'>
      <div class="upvote-container">
        <button name="button" type="button" class="new-upvote-button" data-upvotable-id="1167" data-upvotable-type="Tutorial" data-include-caret="false"><span class="icon new-upvote-icon"><svg class='svg-icon svg-icon-heart'><use xlink:href='https://www.digitalocean.com/assets/community/icon-sprite-d76eb75d70ccf8ffb4c0b47b7dbc88ca.svg#icon-heart'></use></svg></span><span class="new-upvote-text">Upvote</span><span class="new-upvote-count">111</span></button>
      </div>
      <div class="section-item section-item-subscribe">
  <span class="opt-in-switch off signed-out-subscribe">
    <span class="subscribe-label">
      <span class="icon icon-subscribe"></span>
      <span class="subscription-label subscribe">Subscribe</span>
      <span class="icon icon-subscribed"></span>
      <span class="subscription-label subscribed">Subscribed</span>
    </span>
    <a data-toggle="modal" data-target="#sign-in-modal" class="mini-switch-container" href="javascript:void(0);"><div class="mini-switch off signed-out-subscribe"><div class="switch-handle"></div></div></a>
  </span>
</div>

<div class='section-item social-sharing-item'>
  <div class="sharing">
  <a class="share-button" href="#" data-toggle="modal" data-target="#share-modal">
    <span class="icon icon-share-square"></span>
    <span class="share-button-text">Share</span>
  </a>
</div>

</div>

    </div>
  </div>
</div>


  <div class='section-content tutorial-contributors one'>


  </div>
</div>


  
    <div class='tutorial-ctas'>
  <div class='section-content'>
    <div class='cta-description'>
      <h2>Spin up an SSD cloud server in under a minute.</h2>

      <p>Simple setup. Full root access. Straightforward pricing.</p>

      <a class="cloud-tutorial-cta" href="https://www.digitalocean.com/?utm_medium=community&amp;utm_source=community_gencta&amp;utm_campaign=needaserver&amp;utm_content=how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04">Deploy Server</a>
    </div>
  </div>
</div>
    <div class='related-tutorials'>
    <div class='section-content'>
      <h2>Related Tutorials</h2>

      <ul>
        <li><a class="related-link" href="/community/tutorials/how-to-test-your-firewall-configuration-with-nmap-and-tcpdump">How To Test your Firewall Configuration with Nmap and Tcpdump</a></li>
<li><a class="related-link" href="/community/tutorials/how-the-iptables-firewall-works">How the Iptables Firewall Works</a></li>
<li><a class="related-link" href="/community/tutorials/a-comparison-of-let-s-encrypt-commercial-and-private-certificate-authorities-and-self-signed-ssl-certificates">A Comparison of Let&#39;s Encrypt, Commercial and Private Certificate Authorities, and Self-Sign...</a></li>
<li><a class="related-link" href="/community/tutorials/how-to-ssh-securely-with-kryptonite-on-digitalocean">How To SSH Securely with Kryptonite on DigitalOcean</a></li>
<li><a class="related-link" href="/community/tutorials/how-to-deploy-a-laravel-application-with-nginx-on-ubuntu-16-04">How To Deploy a Laravel Application with Nginx on Ubuntu 16.04</a></li>

      </ul>
    </div>
  </div>

</div>

<div class="content-comments">
  <div class="section-content">
    <div class="tutorial commentable" id="tutorial_1167">

  <div class="comments-header">
    <h4 class="comments-count"><span>72 Comments</span></h4>
  </div>

  <div class="response response-form no-avatar">
  <div class="js-display-on-error flash error hidden"></div>


  <form class="content-form disabled-form" id="new_comment" action="/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04/comments" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />

    <textarea name="comment[content]" id="comment_content" placeholder="Leave a comment..." class="js-comment-content tutorial-comment-field" data-markdown="true"></textarea>

      <div class="log-in-notice "><a href="/community/auth/digitalocean">Log In to Comment</a></div>

    <div class='clearfix'></div>
</form>
</div>


  <div class="comments">
    <ul class="response-list">
          <a class="js-click-on-load hidden" rel="nofollow" data-remote="true" href="/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04/comments">Load</a>
    </ul>

      <div class='comments-spinner'><div class="spinner spinner-large">
  <div class="bounce1"></div>
  <div class="bounce2"></div>
  <div class="bounce3"></div>
  
</div>
</div>
  </div>

  <div class='load-more-container'></div>
</div>


  </div>
</div>

<div class="creative-commons">
  <a class="creative-commons-image" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img rel="license" alt="Creative Commons License" src="/assets/community/creativecommons-08b32a9279fcd47fcd78ac6a26331389.png" /></a>
    <div class="license-text">This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</div>
</div>





        <div class="clearfix"></div>
      </div>

      <footer class='Footer'>
  <span class="Footer-logo icon-sammy"></span>

  <div>Copyright &copy; 2017 DigitalOcean&trade; Inc.</div>

  <ul class="Footer-nav">
    <li><a href="/community">Community</a></li>
    <li><a href="/community/tutorials">Tutorials</a></li>
    <li><a href="/community/questions">Questions</a></li>
    <li><a href="/community/projects">Projects</a></li>
    <li><a href="/community/tags">Tags</a></li>
    <li><a href="/community/newsletter">Newsletter</a></li>
    <li>
      <a href="/community/tutorials/feed">
        RSS <span class="icon-rss"></span>
</a>    </li>
  </ul>

  <br />

  <ul class="Footer-nav Footer-nav--secondary">
    <li><a href="https://www.digitalocean.com/features/one-click-apps/">Distros &amp; One-Click Apps</a></li>
    <li><a href="https://www.digitalocean.com/legal/terms/">Terms, Privacy, &amp; Copyright</a></li>
    <li><a href="https://www.digitalocean.com/security/">Security</a></li>
      <li><a data-toggle="modal" data-target="#sign-in-modal" href="#">Report a Bug</a></li>
    <li><a href="/community/get-paid-to-write">Get Paid to Write</a></li>
    <li><a href="http://store.digitalocean.com/">Shop</a></li>
  </ul>
</footer>





      <div id='sign-in-modal' class='modal fade mini-modal' style="display: none;">
  <div class='modal-dialog'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h1>Almost there!</h1>
        <a class='close-button' data-dismiss='modal' aria-label="close"  href=''><span class='icon icon-close-light'></span></a>
      </div>
      <div class='modal-body'>
        <div class='sign-in-message'>Sign into your account, or create a new one, to start interacting.</div>

        <div class='sign-in-modal-actions'>
          <a class="sign-in-link button blue-button" data-default-url="/community/auth/digitalocean" href="/community/auth/digitalocean">Log In</a>
          <a class="sign-up-link button green-button" data-default-url="/community/auth/digitalocean?display=sessionless+register" href="/community/auth/digitalocean?display=sessionless+register">Sign Up</a>
        </div>
      </div>
    </div>
  </div>
</div>



    
  <script>
    $(function() {
      if (!!window.init_sharing) {
        window.init_sharing();
      }
      new window.NewsletterSignup();
      new window.GrowableMarkdown({ target: '[data-growable-markdown]' });

      window.Bugsnag.beforeNotify = function(payload, metaData) {
        // custom logic to determine groupingHash
        metaData.groupingHash = "tutorialShow";
      }
    });
  </script>

  <div id='report-a-bug-modal' class='modal fade mini-modal' style="display: none;">
    <div class='modal-dialog'>
      <div class='modal-content'>
        <div class='modal-header'>
          <h1>Report a Bug</h1>
          <a class='close-button' data-dismiss='modal' aria-label="close" href=''><span class='icon icon-close-light'></span></a>
        </div>
        <div class='modal-body'>
          <div class='report-a-bug-message text-center'>Use this form to report bugs related to the Community</div>
          <div class='report-a-bug-actions do-form'>
            <div class='form-wrap'>
              <form class="new_bug_report" id="new_bug_report" action="/community/bug_reports" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="jLh1Bq8JKjuouIiE96I5dVkKsUpUnlpA5slR/6E1z5Wttwziy6d9lzpAq3IwWTr5DSmiTVuZ2dQ65w2xsh55FQ==" />
                <fieldset name="report-a-bug-info">
                <legend class="sr-only">Report a bug:</legend>
                  <div class="field">
                    <label for="bug_reporter_name" class="sr-only">Name</label>
                    <input placeholder="Name" id="bug_reporter_name" type="text" name="bug_report[name]" />
                  </div>
                  <div class="field">
                    <label for="bug_reporter_email" class="sr-only">Email</label>
                    <input name="Email" placeholder="Email" id="bug_reporter_email" required="required" type="text" />
                  </div>
                  <div class="field">
                    <label for="bug_reporter_message" class="sr-only">Message</label>
                    <textarea name="Message" placeholder="Message" id="bug_reporter_message" required="required"></textarea>
                  </div>

                  <div class="field actions">
                    <input type="submit" name="commit" value="Submit" class="button" />
                  </div>
                </fieldset>
</form>            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


    
  </body>
</html>
